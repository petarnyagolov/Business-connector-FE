import{b as p}from"./chunk-KN5H3PP4.js";import{Fd as c,S as i,W as v,Z as n,i as o,l as u,uc as d}from"./chunk-BKAIPBB7.js";var S=class r{constructor(e,t){this.http=e;this.authService=t;this.authService.isAuthenticated()&&this.loadSavedRequestsCount()}apiUrl=c.apiUrl+"/saved-requests";savedRequestsSubject=new u([]);savedRequests$=this.savedRequestsSubject.asObservable();savedRequestsCountSubject=new u(0);savedRequestsCount$=this.savedRequestsCountSubject.asObservable();getAllSavedRequests(){return this.http.get(this.apiUrl).pipe(i(e=>{this.savedRequestsSubject.next(e),this.savedRequestsCountSubject.next(e.length)}))}saveRequest(e){return this.http.post(`${this.apiUrl}/${e}`,{}).pipe(i(()=>{this.loadSavedRequestsCount(),this.savedRequestsSubject.value.length>0&&this.getAllSavedRequests().subscribe()}))}removeSavedRequest(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(i(()=>{let a=this.savedRequestsSubject.value.filter(s=>s.requestCompany.id!==e);this.savedRequestsSubject.next(a),this.savedRequestsCountSubject.next(a.length)}))}isRequestSaved(e){return this.http.get(`${this.apiUrl}/${e}/is-saved`)}getSavedRequestsCount(){return this.http.get(`${this.apiUrl}/count`).pipe(i(e=>{this.savedRequestsCountSubject.next(e.count)}))}loadSavedRequestsCount(){this.getSavedRequestsCount().subscribe({error:e=>{console.error("Error loading saved requests count:",e)}})}isRequestSavedLocally(e){return this.savedRequestsSubject.value.some(t=>t.requestCompany.id===e)}toggleSavedRequest(e){return new o(t=>{this.isRequestSaved(e).subscribe({next:a=>{a.isSaved?this.removeSavedRequest(e).subscribe({next:s=>{t.next({action:"removed",result:s}),t.complete()},error:s=>t.error(s)}):this.saveRequest(e).subscribe({next:s=>{t.next({action:"saved",result:s}),t.complete()},error:s=>t.error(s)})},error:a=>t.error(a)})})}clearCache(){this.savedRequestsSubject.next([]),this.savedRequestsCountSubject.next(0)}initializeForAuthenticatedUser(){this.loadSavedRequestsCount()}static \u0275fac=function(t){return new(t||r)(n(d),n(p))};static \u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"})};export{S as a};
