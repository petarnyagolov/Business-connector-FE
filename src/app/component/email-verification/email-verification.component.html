<div class="verification-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –∏–º–µ–π–ª</mat-card-title>
      <div class="header-actions">
        <button mat-icon-button (click)="goBack()" matTooltip="–ù–∞–∑–∞–¥">
          <mat-icon>arrow_back</mat-icon>
        </button>
      </div>
    </mat-card-header>
    <mat-card-content>
      
      <!-- –¢–∞–±–æ–≤–µ –∑–∞ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∏—Ç–µ -->
      <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="verification-tabs">
        
        <!-- –¢–∞–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è -->
        <mat-tab label="üîó –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è">
          <div class="tab-content">
            <div *ngIf="isLoading" class="spinner-container">
              <mat-spinner diameter="50"></mat-spinner>
              <p>–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞–º–µ –≤–∞—à–∏—è –∏–º–µ–π–ª...</p>
            </div>

            <div *ngIf="!isLoading && isVerified">
              <div class="success-section">
                <mat-icon class="success-icon">check_circle</mat-icon>
                <p class="success-message">–í–∞—à–∏—è—Ç –∏–º–µ–π–ª –±–µ—à–µ —É—Å–ø–µ—à–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞–Ω!</p>
                
                <!-- –ü–æ–∫–∞–∑–≤–∞–º–µ –ø—Ä–æ–≥—Ä–µ—Å –∑–∞ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫–µ–Ω–∞ -->
                <div *ngIf="isRefreshingToken" class="token-refresh-section">
                  <mat-spinner diameter="30"></mat-spinner>
                  <p class="refresh-message">{{ tokenRefreshMessage }}</p>
                </div>
                
                <!-- –ü–æ–∫–∞–∑–≤–∞–º–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞ –æ—Ç –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫–µ–Ω–∞ -->
                <div *ngIf="!isRefreshingToken && tokenRefreshMessage" class="token-status-section">
                  <p class="token-status" [ngClass]="{'success': tokenRefreshMessage.includes('‚úÖ'), 'warning': tokenRefreshMessage.includes('‚ö†Ô∏è')}">
                    {{ tokenRefreshMessage }}
                  </p>
                </div>
                
                <!-- –î–µ–π—Å—Ç–≤–∏—è —Å–ª–µ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è -->
                <div class="action-buttons" *ngIf="!isRefreshingToken">
                  <button *ngIf="shouldShowLoginButton" mat-raised-button color="primary" (click)="navigateToLogin()">
                    <mat-icon>login</mat-icon>
                    –í–ª–∏–∑–∞–Ω–µ
                  </button>
                  <button *ngIf="shouldShowCompaniesButton" mat-raised-button color="primary" (click)="navigateToCompanies()">
                    <mat-icon>business</mat-icon>
                    –ö—ä–º —Ñ–∏—Ä–º–∏—Ç–µ
                  </button>
                </div>
              </div>
            </div>

            <div *ngIf="!isLoading && errorMessage">
              <div class="error-section">
                <mat-icon class="error-icon">error</mat-icon>
                <p class="error-message">{{ errorMessage }}</p>
                
                <form (ngSubmit)="resendVerificationLink()" class="resend-form">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>–ò–º–µ–π–ª –∞–¥—Ä–µ—Å</mat-label>
                    <input matInput [(ngModel)]="resendEmail" name="resendEmail" type="email" required [disabled]="isResending">
                    <mat-icon matSuffix>email</mat-icon>
                  </mat-form-field>
                  <button mat-raised-button color="primary" type="submit" [disabled]="isResending" class="full-width">
                    <mat-icon>send</mat-icon>
                    {{ isResending ? '–ò–∑–ø—Ä–∞—â–∞ —Å–µ...' : '–ò–∑–ø—Ä–∞—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ª–∏–Ω–∫' }}
                  </button>
                </form>
                
                <div *ngIf="resendMessage" class="resend-message">{{ resendMessage }}</div>
                
                <button mat-stroked-button (click)="navigateToLogin()" class="back-button">
                  <mat-icon>arrow_back</mat-icon>
                  –û–±—Ä–∞—Ç–Ω–æ –∫—ä–º –≤–ª–∏–∑–∞–Ω–µ
                </button>
              </div>
            </div>
            <div *ngIf="!isLoading && !isVerified && !errorMessage" class="no-token-section">
              <mat-icon class="info-icon">info</mat-icon>
              <p>–ù—è–º–∞ —Ç–æ–∫–µ–Ω –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è.</p>
              <p>–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Ç–∞–±–∞ "–†—ä—á–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è" –∑–∞ –¥–∞ –≤—ä–≤–µ–¥–µ—Ç–µ —Ç–æ–∫–µ–Ω –¥–∏—Ä–µ–∫—Ç–Ω–æ.</p>
            </div>
          </div>
        </mat-tab>
        <mat-tab label="üîë –†—ä—á–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è">
          <div class="tab-content">
            <div class="manual-verification-section">
              <div class="manual-header">
                <mat-icon class="manual-icon">vpn_key</mat-icon>
                <h3>–†—ä—á–Ω–æ –≤—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ö–µ—à–∞ –æ—Ç –∏–º–µ–π–ª–∞</h3>
                <p>–ò–º–∞—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–µ–Ω —Ö–µ—à –æ—Ç –∏–º–µ–π–ª–∞? –í—ä–≤–µ–¥–µ—Ç–µ –≥–æ —Ç—É–∫ –∑–∞ –Ω–µ–∑–∞–±–∞–≤–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è:</p>
              </div>
              <mat-expansion-panel class="instructions-panel">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <mat-icon>help_outline</mat-icon>
                    –ö–∞–∫ –¥–∞ –Ω–∞–º–µ—Ä–∏—Ç–µ —Ö–µ—à–∞?
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="instructions-content">
                  <ol>
                    <li>–û—Ç–≤–æ—Ä–µ—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏—è –∏–º–µ–π–ª</li>
                    <li>–ù–∞–º–µ—Ä–µ—Ç–µ –ª–∏–Ω–∫–∞ –∑–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è<br>
                        <code>http://localhost:4200/verify-email?t=<strong>YOUR_TOKEN</strong></code>
                    </li>
                    <li>–ö–æ–ø–∏—Ä–∞–π—Ç–µ —á–∞—Å—Ç—Ç–∞ —Å–ª–µ–¥ "t=" (—Ç–æ–≤–∞ –µ –≤–∞—à–∏—è—Ç —Ö–µ—à)</li>
                    <li>–ü–æ—Å—Ç–∞–≤–µ—Ç–µ —Ö–µ—à–∞ –≤ –ø–æ–ª–µ—Ç–æ –ø–æ-–¥–æ–ª—É</li>
                  </ol>
                </div>
              </mat-expansion-panel>
              <form (ngSubmit)="verifyManualToken()" class="manual-form">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–µ–Ω —Ö–µ—à</mat-label>
                  <textarea matInput [(ngModel)]="manualToken" name="manualToken" 
                           placeholder="–ü–æ—Å—Ç–∞–≤–µ—Ç–µ —Ö–µ—à–∞ –æ—Ç –∏–º–µ–π–ª–∞ —Ç—É–∫..."
                           [disabled]="isVerifyingManual"
                           rows="3"></textarea>
                  <mat-icon matSuffix>security</mat-icon>
                </mat-form-field>
                
                <button mat-raised-button color="primary" type="submit" 
                        [disabled]="!manualToken || isVerifyingManual" 
                        class="verify-button">
                  <mat-icon>{{ isVerifyingManual ? 'hourglass_empty' : 'verified_user' }}</mat-icon>
                  {{ isVerifyingManual ? '–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞...' : '–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞–π —Å–µ–≥–∞' }}
                </button>
              </form>
              
              <div *ngIf="manualVerificationMessage || isVerifyingManual" class="manual-result">
                <!-- –ü–æ–∫–∞–∑–≤–∞–º–µ –ø—Ä–æ–≥—Ä–µ—Å –¥–æ–∫–∞—Ç–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞–º–µ –∏–ª–∏ –æ–±–Ω–æ–≤—è–≤–∞–º–µ —Ç–æ–∫–µ–Ω–∞ -->
                <div *ngIf="isVerifyingManual || isRefreshingToken" class="progress-section">
                  <mat-spinner diameter="30"></mat-spinner>
                  <p>{{ isVerifyingManual ? '–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞–º–µ —Ç–æ–∫–µ–Ω–∞...' : tokenRefreshMessage }}</p>
                </div>
                
                <!-- –ü–æ–∫–∞–∑–≤–∞–º–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞ —Å–ª–µ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è -->
                <mat-card *ngIf="!isVerifyingManual && !isRefreshingToken && manualVerificationMessage" 
                         [class]="manualVerificationSuccess ? 'success-card' : 'error-card'">
                  <mat-card-content>
                    <div class="result-content">
                      <mat-icon class="result-icon">
                        {{ manualVerificationSuccess ? 'check_circle' : 'error' }}
                      </mat-icon>
                      <p>{{ manualVerificationMessage }}</p>
                    </div>
                  </mat-card-content>
                </mat-card>
                
                <div *ngIf="manualVerificationSuccess && !isRefreshingToken" class="post-verification-actions">
                  <button *ngIf="shouldShowLoginButton" mat-raised-button color="primary" (click)="navigateToLogin()">
                    <mat-icon>login</mat-icon>
                    –í–ª–∏–∑–∞–Ω–µ
                  </button>
                  <button *ngIf="shouldShowCompaniesButton" mat-raised-button color="primary" (click)="navigateToCompanies()">
                    <mat-icon>business</mat-icon>
                    –ö—ä–º —Ñ–∏—Ä–º–∏—Ç–µ
                  </button>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
      <mat-expansion-panel *ngIf="showDebugInfo" class="debug-panel">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>bug_report</mat-icon>
            Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="debug-content">
          <div class="debug-item">
            <span class="debug-label">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª –µ –ª–æ–≥–Ω–∞—Ç:</span>
            <span [class]="authService.isAuthenticated() ? 'debug-true' : 'debug-false'">
              {{ authService.isAuthenticated() ? '–î–∞' : '–ù–µ' }}
            </span>
          </div>
          <div class="debug-item">
            <span class="debug-label">Email –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞–Ω:</span>
            <span [class]="authService.isEmailVerified() ? 'debug-true' : 'debug-false'">
              {{ authService.isEmailVerified() ? '–î–∞' : '–ù–µ' }}
            </span>
          </div>
          <div class="debug-item">
            <span class="debug-label">–ü–æ–∫–∞–∑–≤–∞ Login –±—É—Ç–æ–Ω:</span>
            <span [class]="shouldShowLoginButton ? 'debug-true' : 'debug-false'">
              {{ shouldShowLoginButton ? '–î–∞' : '–ù–µ' }}
            </span>
          </div>
          <div class="debug-item">
            <span class="debug-label">–ü–æ–∫–∞–∑–≤–∞ Companies –±—É—Ç–æ–Ω:</span>
            <span [class]="shouldShowCompaniesButton ? 'debug-true' : 'debug-false'">
              {{ shouldShowCompaniesButton ? '–î–∞' : '–ù–µ' }}
            </span>
          </div>
          <div class="debug-item">
            <span class="debug-label">–†—ä—á–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è:</span>
            <span [class]="manualVerificationSuccess ? 'debug-true' : 'debug-false'">
              {{ manualVerificationSuccess ? '–£—Å–ø–µ—à–Ω–∞' : '–ù–µ' }}
            </span>
          </div>
        </div>
      </mat-expansion-panel>

    </mat-card-content>
  </mat-card>
</div>
